<!DOCTYPE html>
<html lang="en">
<head>
  <title>Chat Example</title>
</head>
<body>
<div id="winners"></div>
<form action="" method="post">
  <input id="token-input" type="text" class="text" value="" name="token" placeholder="Token">
  <input type="submit" value="Connect">
</form>

<script type="text/javascript">
  let conn
  let token

  const form = document.querySelector('form')
  form.addEventListener('submit', (event) => {
    event.preventDefault()
    token = document.getElementById('token-input').value
    connect()
  })

  function connect() {
    conn = new WebSocket("ws://" + document.location.host + "/ws/chat");
    setupListeners(conn)
  }

  function setupListeners(conn) {
    conn.onopen = (event) => {
      ws.send(JSON.stringify({
        type: 'authenticate',
        payload: { token: token }
      }))
    }
    conn.onclose = (event) => {
      console.log('Connection lost')
    }
    conn.onmessage = (event) => {
      console.log('Message received')
      const message = JSON.parse(event.data)
      switch (message.type) {
        case 'status':
          console.log(message.status)
          break
        case 'error':
          console.error(message.error)
          break
        case 'winners':
          console.log(message.winners)
          break
      }
    }
  }
</script>
</body>
</html>
